# 1
с Божьей помощью
# 2 
## Задача
Вывести курсы и цену курсов, на которые студенты за один раз тратили больше денег, чем на другие курсы. 
Результат отсортировать по названию курса по убыванию
## План
1. Вывести все данные
2. Ввести условие
3. Пропписать сортировку

# 3 
## Задача 
Вывести имя, электронную почту, номер телефона тех студентов, кто записался на курс по социологии и заплатил за него более 42000 рублей, 
-- а также инструктора, который будет преподавать на данном курсе. Результат должен быть получен одним запросом.
## План
1. Из таблицы **enrollments** вывести курс, который удовлетворяет условиям `where em.course_name = 'Социология' and em.price > 42000`.
2. Присоединить таблицу `students` и вывести из нее все нужные данные `s.full_name, s.email, s.phone`
3. Присоединить таблицу `cases` и вывести информацию по инструктору

# 4
## Задача  
Вывести имена студентов, которые записались на курсы, по которым несколько инструкторов начиная с 2021 года, а также средняя цена по курсам должна быть больше 20000 рублей. У самих же студентов оценка за курсы должна быть больше 3.
## План
1. Сначала ывыедем все курсы, и сделаем себе заготовку, чтобы было удобно прокинуть условие вывода
```sql
select
	c.course_name as course_name
from courses.enrollments as en
all left join courses.courses as c 
	on en.course_name = c.course_name
```
2. Группируем и добавляем условие вывода, и таким образом мы заканчиваем составление нашего подзапроса
```sql
group by c.course_name
having countIf(distinct c.instructor, toYear(c.start_date)>=2021)>1 and avg(price) > 20000
```
3. Строим основной запрос.
   Также сначала прописываем откуда мы берем таблицу, потом приджойним необходимые таблицы, затем выведем тех сотрудников, кто посещает те курсы, что есть у нас в подзапросе
```sql
select 
	t2.full_name
from courses.enrollments as t1
any left join courses.students as t2 on t1.student_id = t2.id
where t1.course_name in 
(
```
Тянем данные из t2, чтобы не потерять ни одного студента при таком типе соединения таблиц
4. И, наконец, добавляем условие по оценкам
```sql
) and t1.grade > 3
```

# 5
## Задача
- Вывести всех студентов, их город и курс, который они выбрали, если они хотели бы посетить еще два и более неодинаковых курса. 
- Вывести последнюю тему из курса, который проходят студенты. Нужно учесть, что студенты должны быть только из городов. 
- При работе со строками использовать только регулярные выражения.
## План
1. По традиции, сначала вывожу блок **from**, и прокидываю все *джойны*
```sql
select 

from courses.enrollments as en
any left join courses.students as t1 on en.student_id = t1.id
any left join courses.courses as c on c.course_id = en.course_id
```
2. Теперь пропишем то, что мы хотим получить:
```sql
--select 
  t1.full_name as name, -- ФИО студента
  extract(t1.address, '(^г.\s[А-Яа-я().\s]+),.*') as town, -- извлекам только города, то есть то, что начинается с буквы г
  en.course_name as course, -- его курс
  c.topics[-1] as topic -- последний курс 
--from courses.enrollments as en
--any left join courses.students as t1 on en.student_id = t1.id
--any left join courses.courses as c on c.course_id = en.course_id
```
3. Прописываем условие для ограничения
```sql
where length(arrayDistinct(t1.wanted_courses))>=2 and match(t1.address, '^г.')
```